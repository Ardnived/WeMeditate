
- allow = policy(@record)
- content_for :title, t('action.target.review', target: @record.model_name.human)

.ui.message Changes were contibuted by X, Y, Z

form
  table.ui.compact.celled.definition.table
    thead
      tr
        th Reject?
        th Field
        th Old Value
        th New Value
    tbody
      - @record.draft.each do |key, value|
        - field_name = human_attribute_name(@model, key)
        - old_value = @record[key]
        tr
          td.collapsing
            .ui.fitted.slider.checkbox
              input type='checkbox' name="reject[#{key}]"
              label
          - case key
            - when 'vimeo_id'
              td.collapsing = field_name
              td
                a href="https://vimeo.com/#{old_value}" target='_blank'
                  i.external.alternate.icon
                  = old_value
              td
                a href="https://vimeo.com/#{value}" target='_blank'
                  i.external.alternate.icon
                  = value
            - when 'thumbnail_id', 'image_id'
              td.collapsing = human_attribute_name(@model, key.delete_suffix('_id'))
              td
                .ui.image
                  img src=MediaFile.find(old_value).file.url(:tiny)
                  .ui.floating.label = "##{old_value}"
              td
                .ui.image
                  img src=MediaFile.find(value).file.url(:tiny)
                  .ui.floating.label = "##{value}"
            - else
              td.collapsing = field_name
              td = old_value
              td = value.is_a?(String) ? Differ.diff_by_char(value, old_value.to_s).format_as(:html).html_safe : value

  | TODO: Add a comparison for content changes

  .ui.hidden.divider

  p
    - if allow.show?
      a.ui.basic.button href=url_for([:admin, @record])
        i.left.arrow.icon
        = translate 'action.back'
    - else
      a.ui.basic.button href=url_for([:admin, defined?(@record.page) ? @record.page : @record.class])
        i.left.arrow.icon
        = translate 'action.target.back', target: @record.model_name.human(count: -1)

    button.ui.basic.primary.button type='submit'
      = translate 'action.publish'

