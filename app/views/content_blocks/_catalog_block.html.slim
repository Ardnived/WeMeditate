
- item_ids = block[:items].map { |item| item[:id] }
- showImages = block[:withImages] != false
- records = block[:type].classify.constantize.published.where(id: item_ids).all
- return unless records.present?

.content__catalog class="content__catalog--#{block[:type]}"
  - if block[:title].present? && block[:type] != 'treatments'
    h2.content__catalog__header
      = inline_svg 'graphics/leaves.svg', class: 'content__catalog__header__leaf'
      .content__catalog__header__text = block[:title]
      = inline_svg 'graphics/leaves.svg', class: 'content__catalog__header__leaf'

  - if block[:type] == 'articles' || !showImages
    .content__catalog__sidetext = render_decoration :sidetext, block, alignment: :left

    .content__catalog__article_grid data-max-columns=3 class=(records.length < 3 ? 'content__catalog__article_grid--centered' : 'js-grid')
      - records.first(3).each do |record|
        article.preview.content__catalog__article
          - if showImages
            a.content__catalog__media.preview__media href=polymorphic_path(record)
              // TODO: Set image sizes properly
              = smart_image_tag record.thumbnail, '33vw', lazy: false, class: 'preview__media__thumbnail', alt: record.name

          a.preview__title href=polymorphic_path(record)
            = record.name
          p.preview__text = record.excerpt
          .preview__meta
            a.preview__meta__link href=polymorphic_path(record)
              = t('articles.read_more')
              .icon.icon--breadcrumb

    - if records.count > 3
      .content__catalog__loadmore.js-loadmore
        button.button.button--box
          = translate 'content.show_more'
        template
          - records.drop(3).each do |record|
            article.preview.content__catalog__article
              h3.preview__title = record.name
              p.preview__text = record.excerpt
              .preview__meta
                a.preview__meta__link href=polymorphic_path(record)
                  = t('articles.read_more')
                  .icon.icon--breadcrumb

  - elsif block[:type] == 'treatments'
    .content__catalog__gradient
      .gradient.gradient--right.gradient--tall.gradient--short.gradient--orange

    h2.content__catalog__title
      - if block[:title]
        = block[:title]
      - else
        = block[:decorations] && block[:decorations][:sidetext] && block[:decorations][:sidetext][:text]
    .content__catalog__sidetext = render_decoration :sidetext, block, alignment: :left

    .content__catalog__treatment_list.excerpt_list
      - records.first(2).each_with_index do |treatment, index|
        article.content__catalog__treatment.excerpt.excerpt--simple class="excerpt--#{index.even? ? 'right' : 'left'}"
          // TODO: Set the image size
          = smart_image_tag treatment.thumbnail, '100vw', class: 'excerpt__image', alt: treatment.name
          .excerpt__content
            h3.excerpt__title = treatment.name
            p.excerpt__text = treatment.excerpt
            a.excerpt__link href=treatment_path(treatment)
              = t('treatments.read_more')
              .icon.icon--breadcrumb
          .clearfix

    - if records.count > 2
      .content__catalog__loadmore.js-loadmore
        button.button.button--box
          = translate block[:type] == 'treatments' ? 'treatments.show_more' : 'content.show_more'
        template
          - records.drop(2).each_with_index do |treatment, index|
            article.content__catalog__treatment.excerpt.excerpt--simple class="excerpt--#{index.even? ? 'right' : 'left'}"
              // TODO: Set the image size
              = smart_image_tag treatment.thumbnail, '100vw', class: 'excerpt__image', alt: treatment.name
              .excerpt__content
                h3.excerpt__title = treatment.name
                p.excerpt__text = treatment.excerpt
                a.excerpt__link href=treatment_path(treatment)
                  = t('treatments.read_more')
                  .icon.icon--breadcrumb
                  
              .clearfix

  - elsif block[:type] == 'meditations'
    .content__catalog__gradient
      .gradient.gradient--right.gradient--tall.gradient--blue
    .content__catalog__sidetext
      = render_decoration :sidetext, block, static: true, alignment: :right

    .carousel.js-carousel data-style='video'
      - records.each do |meditation|
        figure.carousel__item
          a.carousel__video.video href=meditation_path(meditation)
            // TODO: Re-evaluate image_sizes
            // TODO: Maybe try to find a way to re-enable lazyloading
            = smart_image_tag meditation.image, '100vw', class: 'video__thumbnail', lazy: false
            .video__button.video__button

          figcaption.carousel__name = meditation.name
